generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  email              String        @unique
  password           String
  status             Status        @default(PENDING)
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  id                 String        @id @default(uuid())
  profileImage       String?
  isVerified         Boolean       @default(false)
  otpCode            String?
  otpExpiresAt       DateTime?
  activityLogs       ActivityLog[]
  adminProfile       Admin?
  beneficiaryProfile Beneficiary?
  donorProfile       Donor?
}

model Admin {
  id                      String                   @id @default(uuid())
  firstName               String
  lastName                String
  userId                  String                   @unique
  user                    User                     @relation(fields: [userId], references: [id], onDelete: Cascade)
  programApplications     ProgramApplication[]
  programApplicationScans ProgramApplicationScan[]
  stallApplicationsScanned StallApplication[]       @relation("StallApplicationScanner")
  stallApplicationScans    StallApplicationScan[]   @relation("StallApplicationScanAdmin")
  newsletters             Newsletter[]
}

model Beneficiary {
  firstName               String
  lastName                String
  age                     Int
  occupation              String
  householdNumber         Int
  householdAnnualSalary   Float
  userId                  String                @unique
  birthDate               DateTime
  contactNumber           String
  gender                  Gender
  id                      String                @id @default(uuid())
  middleName              String?
  civilStatus             CivilStatus
  status                  Status                @default(PENDING)
  reviewReason            String?
  reviewedAt              DateTime?
  activeEmail             String?
  adultCount              Int                   @default(0)
  childrenCount           Int                   @default(0)
  declarationAccepted     Boolean               @default(false)
  governmentIdFileUrl     String?
  governmentIdType        String?
  householdPosition       HouseholdPosition
  householdPositionDetail String?
  incomeSources           IncomeSource[]        @default([])
  mainEmploymentStatus    MainEmploymentStatus?
  monthlyIncome           Float?
  primaryPhone            String
  privacyAccepted         Boolean               @default(false)
  pwdCount                Int                   @default(0)
  receivingAid            Boolean               @default(false)
  receivingAidDetail      String?
  seniorCount             Int                   @default(0)
  signatureUrl            String?
  specialDietDescription  String?
  specialDietRequired     Boolean               @default(false)
  address                 Address?
  user                    User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  foodSecuritySurveys     FoodSecuritySurvey[]
  householdMembers        HouseholdMember[]
  programRegistrations    ProgramRegistration[]
}

model Address {
  streetNumber  String
  barangay      String
  municipality  String
  region        String
  country       String      @default("Philippines")
  zipCode       String
  beneficiaryId String      @unique
  id            String      @id @default(uuid())
  beneficiary   Beneficiary @relation(fields: [beneficiaryId], references: [id], onDelete: Cascade)
}

model HouseholdMember {
  id            String      @id @default(uuid())
  fullName      String
  birthDate     DateTime
  age           Int
  relationship  String
  beneficiaryId String
  beneficiary   Beneficiary @relation(fields: [beneficiaryId], references: [id], onDelete: Cascade)
}

model FoodSecuritySurvey {
  id            String               @id @default(uuid())
  beneficiaryId String
  periodStart   DateTime
  periodEnd     DateTime
  q1            FoodFrequency
  q2            FoodFrequency
  q3            FoodFrequency
  q4            FoodFrequency
  q5            FoodFrequency
  q6            FoodFrequency
  totalScore    Int                  @default(0)
  severity      FoodSecuritySeverity @default(SECURE)
  createdAt     DateTime             @default(now())
  updatedAt     DateTime             @updatedAt
  beneficiary   Beneficiary          @relation(fields: [beneficiaryId], references: [id], onDelete: Cascade)

  @@unique([beneficiaryId, periodStart, periodEnd])
  @@index([beneficiaryId, periodStart])
}

model Donor {
  displayName   String
  donorType     DonorType
  userId        String     @unique
  id            String     @id @default(uuid())
  status        Status     @default(PENDING)
  reviewReason  String?
  reviewedAt    DateTime?
  totalDonation Float?
  creditBalance Float      @default(0)
  points        Int        @default(0)
  donations     Donation[]
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  stallReservations StallReservation[]
}

model Place {
  id             String          @id @default(uuid())
  name           String
  address        String
  latitude       Float
  longitude      Float
  donationCenter DonationCenter?
  programs       Program[]
}

model DonationCenter {
  contactInfo String
  id          String     @id @default(uuid())
  placeId     String     @unique
  donations   Donation[]
  place       Place      @relation(fields: [placeId], references: [id], onDelete: Cascade)
}

model Program {
  id                  String                @id @default(uuid())
  title               String
  description         String
  date                DateTime
  maxParticipants     Int
  createdAt           DateTime              @default(now())
  currentParticipants Int                   @default(0)
  placeId             String
  status              ProgramStatus         @default(SCHEDULED)
  updatedAt           DateTime              @default(now()) @updatedAt
  donations           Donation[]
  place               Place                 @relation(fields: [placeId], references: [id])
  registrations       ProgramRegistration[]
  // Stall reservation capacity for donor stalls
  stallCapacity       Int?                  @default(0)
  reservedStalls      Int                   @default(0)
  stallReservations   StallReservation[]
}

model Donation {
  id                String          @id @default(uuid())
  status            DonationStatus  @default(SCHEDULED)
  scheduledDate     DateTime
  donorId           String?
  createdAt         DateTime        @default(now())
  programId         String?
  donationCenterId  String?
  guestEmail        String?
  guestName         String?
  paymentMethod     String?
  paymentReference  String?
  imageUrls         String[]
  qrCodeRef         String?
  monetaryAmount    Float?
  paymentProvider   String?
  paymentReceiptUrl String?
  paymentStatus     PaymentStatus   @default(PENDING)
  paymentVerifiedAt DateTime?
  donationCenter    DonationCenter? @relation(fields: [donationCenterId], references: [id])
  donor             Donor?          @relation(fields: [donorId], references: [id])
  program           Program?        @relation(fields: [programId], references: [id])
  items             DonationItem[]
}

model DonationItem {
  id         String   @id @default(uuid())
  name       String
  category   String
  quantity   Float
  unit       String
  donationId String
  donation   Donation @relation(fields: [donationId], references: [id], onDelete: Cascade)
}

model AppMetric {
  id             String   @id @default("app-metrics")
  totalMonetary  Float    @default(0)
  updatedAt      DateTime @updatedAt
}

model ProgramRegistration {
  id            String               @id @default(uuid())
  programId     String
  beneficiaryId String
  registeredAt  DateTime             @default(now())
  status        ProgramStatus        @default(PENDING)
  application   ProgramApplication[]
  beneficiary   Beneficiary          @relation(fields: [beneficiaryId], references: [id])
  program       Program              @relation(fields: [programId], references: [id])

  @@unique([programId, beneficiaryId])
}

model StallReservation {
  id            String            @id @default(uuid())
  programId     String
  donorId       String
  slotNumber    Int
  status        ReservationStatus @default(PENDING)
  reservedAt    DateTime          @default(now())
  canceledAt    DateTime?
  checkedInAt   DateTime?
  qrCodeUrl     String?
  qrCodeRef     String?
  notes         String?

  program       Program           @relation(fields: [programId], references: [id], onDelete: Cascade)
  donor         Donor             @relation(fields: [donorId], references: [id], onDelete: Cascade)
  application   StallApplication? @relation("StallReservationApplication")

  @@unique([programId, slotNumber])
  @@index([donorId, programId])
}

model StallApplication {
  id                     String             @id @default(uuid())
  stallReservationId     String             @unique
  qrCodeValue            String             @unique
  qrCodeImageUrl         String?
  applicationStatus      ApplicationStatus  @default(PENDING)
  scheduledDate          DateTime?
  qrCodeScannedAt        DateTime?
  qrCodeScannedByAdminId String?
  createdAt              DateTime           @default(now())
  updatedAt              DateTime           @updatedAt

  stallReservation       StallReservation   @relation("StallReservationApplication", fields: [stallReservationId], references: [id], onDelete: Cascade)
  scans                  StallApplicationScan[]
  qrCodeScannedByAdmin   Admin?             @relation("StallApplicationScanner", fields: [qrCodeScannedByAdminId], references: [id])
}

model StallApplicationScan {
  id                 String            @id @default(uuid())
  stallApplicationId String
  scannedAt          DateTime          @default(now())
  notes              String?
  scannedByAdminId   String?

  application        StallApplication  @relation(fields: [stallApplicationId], references: [id], onDelete: Cascade)
  scannedByAdmin     Admin?            @relation("StallApplicationScanAdmin", fields: [scannedByAdminId], references: [id])
}

enum ReservationStatus {
  PENDING
  APPROVED
  CANCELLED
  CHECKED_IN
}

model ProgramApplication {
  id                     String                   @id @default(uuid())
  applicationStatus      ApplicationStatus        @default(PENDING)
  qrCodeValue            String                   @unique
  qrCodeImageUrl         String?
  scheduledDeliveryDate  DateTime
  actualDeliveryDate     DateTime?
  qrCodeScannedAt        DateTime?
  qrCodeScannedByAdminId String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  programRegistrationId  String?
  adminId                String?
  registrationId         String?
  admin                  Admin?                   @relation(fields: [adminId], references: [id])
  registration           ProgramRegistration?     @relation(fields: [registrationId], references: [id], onDelete: Cascade)
  scans                  ProgramApplicationScan[]
}

model ProgramApplicationScan {
  id               String             @id @default(uuid())
  scannedAt        DateTime           @default(now())
  notes            String?
  applicationId    String
  scannedByAdminId String?
  adminId          String?
  qrCodeValue      String?
  admin            Admin?             @relation(fields: [adminId], references: [id])
  application      ProgramApplication @relation(fields: [applicationId], references: [id], onDelete: Cascade)
}

model ActivityLog {
  id        String   @id @default(uuid())
  action    String
  details   String?
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

enum Status {
  PENDING
  APPROVED
  VERIFIED
  REJECTED
  DEACTIVATED
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum CivilStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

enum DonorType {
  INDIVIDUAL
  ORGANIZATION
  BUSINESS
}

enum DonationStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  VERIFIED
  FAILED
}

enum ProgramStatus {
  PENDING
  APPROVED
  CLAIMED
  CANCELED
  REJECTED
  SCHEDULED
}

enum ApplicationStatus {
  PENDING
  COMPLETED
  CANCELLED
}

enum HouseholdPosition {
  MOTHER
  FATHER
  SON
  DAUGHTER
  GRANDMOTHER
  GRANDFATHER
  UNCLE
  AUNTIE
  OTHER_RELATIVE
  NON_RELATIVE_GUARDIAN
}

enum IncomeSource {
  FORMAL_SALARIED
  INFORMAL_GIG
  GOV_ASSISTANCE
  REMITTANCE
  NONE
}

enum MainEmploymentStatus {
  EMPLOYED_FULL_TIME
  EMPLOYED_PART_TIME
  RECENTLY_UNEMPLOYED
  LONG_TERM_UNEMPLOYED
  RETIRED_DISABLED
}

enum FoodFrequency {
  NEVER
  RARELY
  SOMETIMES
  OFTEN
}

enum FoodSecuritySeverity {
  SECURE
  MILD
  MODERATE
  SEVERE
}

model Newsletter {
  id        String   @id @default(uuid())
  headline  String
  content   String
  images    String[] @default([])
  adminId   String
  admin     Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
