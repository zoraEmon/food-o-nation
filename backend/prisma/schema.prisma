// FOOD-O-NATION COMPLETE SCHEMA
// Includes User, Admin, Beneficiary, Donor, Operations, and Logs

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql" 
  url      = env("DATABASE_URL")
}

// =========================================================
// ENUMS
// =========================================================

enum Status {
  PENDING
  APPROVED
  REJECTED
  DEACTIVATED
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum CivilStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

enum DonorType {
  INDIVIDUAL
  ORGANIZATION
  BUSINESS
}

enum DonationStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

// =========================================================
// 1. CORE USER MANAGEMENT
// =========================================================
model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  status        Status    @default(PENDING)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Profiles (1:1 Relations)
  beneficiaryProfile Beneficiary?
  donorProfile       Donor?
  adminProfile       Admin?

  // Logs (1:N Relation)
  activityLogs       ActivityLog[]
}

//I have just added the table for admins. [28//11/2025]
// =========================================================
// 2. ADMIN PROFILE (1:1 with User)
// =========================================================
model Admin {
  id            String    @id @default(uuid())
  firstName     String
  lastName      String
  
  // Relations
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// =========================================================
// 3. BENEFICIARY PROFILE (1:1 with User)
// =========================================================
model Beneficiary {
  id                    String      @id @default(uuid())
  firstName             String
  lastName              String
  middleName            String?
  gender                Gender
  birthDate             DateTime
  contactNumber         String
  age                   Int
  civilStatus           CivilStatus
  occupation            String
  householdNumber       Int
  householdAnnualSalary Float

  // Relations
  userId                String    @unique
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  address               Address?              // 1:1 relation
  programRegistrations  ProgramRegistration[] // 1:N relation
}

// =========================================================
// 4. ADDRESS (1:1 with Beneficiary)
// =========================================================
model Address {
  id            String    @id @default(uuid())
  streetNumber  String
  barangay      String
  municipality  String
  region        String
  country       String    @default("Philippines")
  zipCode       String

  // Foreign Key to Beneficiary
  beneficiaryId String    @unique
  beneficiary   Beneficiary @relation(fields: [beneficiaryId], references: [id], onDelete: Cascade)
}

// =========================================================
// 5. DONOR PROFILE (1:1 with User)
// =========================================================
model Donor {
  id            String    @id @default(uuid())
  displayName   String
  donorType     DonorType
  totalDonation Float?    // Derived/Optional field

  // Relations
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  donations     Donation[] // 1:N relation
}

// =========================================================
// 6. DONATION CENTER (1:N with Program)
// =========================================================
model DonationCenter {
  id          String   @id @default(uuid())
  name        String
  address     String
  latitude    Float
  longitude   Float
  contactInfo String

  programs    Program[] // 1:N relation
}

// =========================================================
// 7. PROGRAM (Events / Campaigns)
// =========================================================
model Program {
  id                  String   @id @default(uuid())
  title               String
  description         String
  location            String
  date                DateTime
  maxParticipants     Int
  currentParticipants Int      @default(0)

  // Relation to Donation Center (N:1)
  centerId            String
  center              DonationCenter @relation(fields: [centerId], references: [id])

  // Program Links
  donations           Donation[]
  registrations       ProgramRegistration[]

  createdAt           DateTime @default(now())
}

// =========================================================
// 8. DONATION (N:1 with Donor, N:1 with Program)
// =========================================================
model Donation {
  id            String          @id @default(uuid())
  type          String
  volume        String
  status        DonationStatus  @default(SCHEDULED)
  scheduledDate DateTime

  // Relations
  donorId       String
  donor         Donor           @relation(fields: [donorId], references: [id])

  programId     String
  program       Program         @relation(fields: [programId], references: [id])

  createdAt     DateTime        @default(now())
}

// =========================================================
// 9. PROGRAM REGISTRATION (M:N junction table)
// =========================================================
model ProgramRegistration {
  id            String    @id @default(uuid())
  status        String
  registeredAt  DateTime  @default(now())

  // Relations
  programId     String
  program       Program   @relation(fields: [programId], references: [id])

  beneficiaryId String
  beneficiary   Beneficiary @relation(fields: [beneficiaryId], references: [id])

  @@unique([programId, beneficiaryId]) // Enforce unique registration per program/beneficiary
}

// =========================================================
// 10. ACTIVITY LOG (N:1 with User)
// =========================================================
model ActivityLog {
  id        String   @id @default(uuid())
  action    String
  details   String?
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
}